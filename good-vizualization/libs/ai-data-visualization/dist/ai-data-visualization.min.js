!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.AIDataVisualization=e():t.AIDataVisualization=e()}(this,()=>(()=>{"use strict";var t={683:(t,e,i)=>{var n,a;i.r(e),i.d(e,{AIDataVisualization:()=>o,AIDataVisualizationError:()=>r,ErrorType:()=>a,VisualizationState:()=>n,create:()=>s,default:()=>d}),function(t){t.IDLE="idle",t.GENERATING="generating",t.DISPLAYING="displaying",t.ERROR="error"}(n||(n={})),function(t){t.CONTAINER_NOT_FOUND="container-not-found",t.INVALID_API_DESCRIPTION="invalid-api-description",t.CHAT_COMPLETION_FAILED="chat-completion-failed",t.API_REQUEST_FAILED="api-request-failed",t.IFRAME_COMMUNICATION_FAILED="iframe-communication-failed",t.INVALID_HTML_RESPONSE="invalid-html-response"}(a||(a={}));class r extends Error{constructor(t,e,i){super(e),this.type=t,this.originalError=i,this.name="AIDataVisualizationError"}}class o{constructor(t){this.state=n.IDLE,this.lastGeneratedCode=null,this.originalPrompt=null,this.improvementPrompts=[],this.inputCollapsed=!1,this.history=[],this.HISTORY_KEY="aiDataVizHistory",this.activeHistoryIndex=null,this.apiOverviewHtml="",this.config=t,this.container=this.resolveContainer(t.container),this.validateConfig(),this.initialize()}resolveContainer(t){if("string"==typeof t){const e=document.querySelector(t);if(!e)throw new r(a.CONTAINER_NOT_FOUND,`Container element not found: ${t}`);return e}return t}validateConfig(){if(!this.config.apiDescription)throw new r(a.INVALID_API_DESCRIPTION,"API description is required");if("function"!=typeof this.config.chatCompletion)throw new r(a.CHAT_COMPLETION_FAILED,"chatCompletion must be a function");if("function"!=typeof this.config.apiRequest)throw new r(a.API_REQUEST_FAILED,"apiRequest must be a function")}initialize(){this.loadHistory(),this.apiOverviewHtml=this.buildApiOverviewHtml(),this.createHTML(),this.attachStyles(),this.setupEventListeners(),this.setupMessageListener(),this.renderHistoryList()}createHTML(){const t=this.config.theme||"light",e=this.config.className||"",i=this.apiOverviewHtml?`<details class="ai-data-viz__api-overview" style="margin-top:8px;"><summary>Available API Endpoints</summary>${this.apiOverviewHtml}</details>`:"";this.container.innerHTML=`\n      <div class="ai-data-viz ${t} ${e}">\n        <div class="ai-data-viz__header">\n          <h2 class="ai-data-viz__title">AI Data Visualization</h2>\n          <p class="ai-data-viz__subtitle">Ask for any visualization and I'll generate it using your API data</p>\n          <button class="ai-data-viz__toggle-input" type="button" aria-label="Hide input">&minus;</button>\n        </div>\n        \n        <div class="ai-data-viz__input-section">\n          <div class="ai-data-viz__input-group">\n            <textarea \n              class="ai-data-viz__textarea" \n              placeholder="Example: Create a chart showing employee allocation by department"\n              rows="3"\n            ></textarea>\n            <button class="ai-data-viz__generate-btn" type="button">\n              <span class="ai-data-viz__btn-text">Generate Visualization</span>\n              <div class="ai-data-viz__spinner" style="display: none;"></div>\n            </button>\n            <button class="ai-data-viz__clear-btn" type="button" style="display: none;">\n              Clear Visualization\n            </button>\n          </div>\n          <details class="ai-data-viz__prompt-summary" style="display:none; margin-top: 8px;">\n            <summary>Original Prompt</summary>\n            <pre class="ai-data-viz__prompt-text" style="white-space: pre-wrap;"></pre>\n          </details>\n          ${i}\n        </div>\n        \n        <div class="ai-data-viz__visualization" style="display: none;">\n          <div class="ai-data-viz__loading" style="display: none;">\n            <div class="ai-data-viz__spinner"></div>\n            <p>Generating visualization...</p>\n          </div>\n          <div class="ai-data-viz__iframe-container">\n            <iframe class="ai-data-viz__iframe" sandbox="allow-scripts"></iframe>\n          </div>\n        </div>\n        <details class="ai-data-viz__history" style="margin-top:12px;">\n          <summary class="ai-data-viz__history-summary">\n            <span>Diagram History</span>\n            <button type="button" title="Clear entire history" class="ai-data-viz__history-clear-btn">&times;</button>\n          </summary>\n          <ul class="ai-data-viz__history-list"></ul>\n        </details>\n        \n        <div class="ai-data-viz__error" style="display: none;">\n          <div class="ai-data-viz__error-content">\n            <p class="ai-data-viz__error-message"></p>\n            <button class="ai-data-viz__error-retry" type="button">Try Again</button>\n          </div>\n        </div>\n      </div>\n    `}attachStyles(){if(document.getElementById("ai-data-viz-styles"))return;const t=document.createElement("style");t.id="ai-data-viz-styles",t.textContent=this.getStyles(),document.head.appendChild(t)}getStyles(){return`\n      .ai-data-viz {\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        max-width: 1200px;\n        margin: 0 auto;\n        padding: 20px;\n        border: 1px solid #e0e0e0;\n        border-radius: 8px;\n        background: #ffffff;\n        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n      }\n\n      .ai-data-viz.dark {\n        background: #1a1a1a;\n        border-color: #333;\n        color: #ffffff;\n      }\n\n      .ai-data-viz__header {\n        margin-bottom: 24px;\n        text-align: center;\n        position: relative;\n      }\n\n      .ai-data-viz__title {\n        margin: 0 0 8px 0;\n        font-size: 24px;\n        font-weight: 600;\n        color: #333;\n      }\n\n      .ai-data-viz.dark .ai-data-viz__title {\n        color: #ffffff;\n      }\n\n      /* Toggle input button */\n      .ai-data-viz__toggle-input {\n        position: absolute;\n        top: 0;\n        right: 0;\n        background: transparent;\n        border: none;\n        font-size: 24px;\n        cursor: pointer;\n        color: inherit;\n        line-height: 1;\n        padding: 4px 8px;\n      }\n\n      .ai-data-viz__toggle-input:hover {\n        opacity: 0.7;\n      }\n\n      .ai-data-viz__subtitle {\n        margin: 0;\n        color: #666;\n        font-size: 14px;\n      }\n\n      .ai-data-viz.dark .ai-data-viz__subtitle {\n        color: #ccc;\n      }\n\n      .ai-data-viz__input-section {\n        margin-bottom: 20px;\n      }\n\n      .ai-data-viz__input-group {\n        display: flex;\n        gap: 12px;\n        margin-bottom: 12px;\n      }\n\n      .ai-data-viz__textarea {\n        flex: 1;\n        padding: 12px;\n        border: 1px solid #ddd;\n        border-radius: 6px;\n        font-family: inherit;\n        font-size: 14px;\n        resize: vertical;\n        min-height: 80px;\n      }\n\n      .ai-data-viz.dark .ai-data-viz__textarea {\n        background: #2a2a2a;\n        border-color: #444;\n        color: #ffffff;\n      }\n\n      .ai-data-viz__textarea:focus {\n        outline: none;\n        border-color: #007bff;\n        box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);\n      }\n\n      .ai-data-viz__generate-btn {\n        padding: 12px 24px;\n        background: #007bff;\n        color: white;\n        border: none;\n        border-radius: 6px;\n        font-family: inherit;\n        font-size: 14px;\n        font-weight: 500;\n        cursor: pointer;\n        transition: background-color 0.2s;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        min-width: 180px;\n        justify-content: center;\n      }\n\n      .ai-data-viz__generate-btn:hover:not(:disabled) {\n        background: #0056b3;\n      }\n\n      .ai-data-viz__generate-btn:disabled {\n        background: #6c757d;\n        cursor: not-allowed;\n      }\n\n      .ai-data-viz__clear-btn {\n        padding: 8px 16px;\n        background: transparent;\n        color: #dc3545;\n        border: 1px solid #dc3545;\n        border-radius: 6px;\n        font-family: inherit;\n        font-size: 14px;\n        cursor: pointer;\n        transition: all 0.2s;\n      }\n\n      .ai-data-viz__clear-btn:hover {\n        background: #dc3545;\n        color: white;\n      }\n\n      .ai-data-viz__spinner {\n        width: 16px;\n        height: 16px;\n        border: 2px solid transparent;\n        border-top: 2px solid currentColor;\n        border-radius: 50%;\n        animation: spin 1s linear infinite;\n      }\n\n      @keyframes spin {\n        to { transform: rotate(360deg); }\n      }\n\n      .ai-data-viz__visualization {\n        margin-top: 20px;\n      }\n\n      .ai-data-viz__loading {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        padding: 40px;\n        color: #666;\n      }\n\n      .ai-data-viz.dark .ai-data-viz__loading {\n        color: #ccc;\n      }\n\n      .ai-data-viz__loading p {\n        margin-top: 12px;\n      }\n\n      .ai-data-viz__iframe-container {\n        border: 1px solid #e0e0e0;\n        border-radius: 6px;\n        overflow: hidden;\n      }\n\n      .ai-data-viz.dark .ai-data-viz__iframe-container {\n        border-color: #444;\n      }\n\n      .ai-data-viz__iframe {\n        width: 100%;\n        height: ${this.config.iframeHeight||600}px;\n        border: none;\n        background: white;\n      }\n\n      .ai-data-viz__error {\n        margin-top: 20px;\n        padding: 16px;\n        background: #f8d7da;\n        border: 1px solid #f5c6cb;\n        border-radius: 6px;\n        color: #721c24;\n      }\n\n      .ai-data-viz.dark .ai-data-viz__error {\n        background: #2d1b1e;\n        border-color: #5a1a1a;\n        color: #f8d7da;\n      }\n\n      .ai-data-viz__error-content {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .ai-data-viz__error-message {\n        margin: 0;\n        flex: 1;\n      }\n\n      .ai-data-viz__error-retry {\n        padding: 6px 12px;\n        background: #dc3545;\n        color: white;\n        border: none;\n        border-radius: 4px;\n        font-size: 12px;\n        cursor: pointer;\n      }\n\n      .ai-data-viz__error-retry:hover {\n        background: #c82333;\n      }\n\n      /* Prompt summary */\n      .ai-data-viz__prompt-summary {\n        background: #f8f9fa;\n        border: 1px solid #ddd;\n        border-radius: 6px;\n        padding: 8px;\n        font-size: 12px;\n        color: #333;\n      }\n\n      .ai-data-viz.dark .ai-data-viz__prompt-summary {\n        background: #2a2a2a;\n        border-color: #444;\n        color: #ccc;\n      }\n\n      /* API overview */\n      .ai-data-viz__api-overview {\n        background: #f1f3f5;\n        border: 1px solid #e0e0e0;\n        border-radius: 6px;\n        padding: 8px;\n        font-size: 12px;\n        color: #333;\n      }\n\n      .ai-data-viz.dark .ai-data-viz__api-overview {\n        background: #252525;\n        border-color: #444;\n        color: #ccc;\n      }\n\n      /* Diagram history container */\n      .ai-data-viz__history {\n        background: #f8f9fa;\n        border: 1px solid #e0e0e0;\n        border-radius: 6px;\n        padding: 8px;\n        font-size: 12px;\n        color: #333;\n      }\n\n      .ai-data-viz.dark .ai-data-viz__history {\n        background: #2a2a2a;\n        border-color: #444;\n        color: #ccc;\n      }\n\n      /* History list */\n      .ai-data-viz__history-list {\n        margin: 6px 0 0 20px;\n        padding: 0;\n        list-style: disc;\n      }\n      .ai-data-viz__history-list li {\n        cursor: pointer;\n        padding: 4px 4px;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n      }\n      .ai-data-viz__history-summary {\n        cursor: pointer;\n        position: relative;\n        padding-right: 18px; /* space for clear button */\n      }\n      .ai-data-viz__history-clear-btn {\n        border: none;\n        color: inherit;\n        font-size: 14px;\n        cursor: pointer;\n        padding: 0;\n        line-height: 1;\n        position: absolute;\n        right: 0;\n        top: 0;\n      }\n      .ai-data-viz__history-btn-div {\n        display: flex;\n        gap: 4px;\n      }\n      .ai-data-viz__history-clear-btn:hover { opacity: 0.7; }\n      .ai-data-viz__history-publish-btn {\n        background: #007bff;\n        border: none;\n        color: #fff;\n        font-size: 11px;\n        padding: 2px 6px;\n        border-radius: 4px;\n        cursor: pointer;\n      }\n      .ai-data-viz__history-publish-btn:hover { opacity: 0.85; }\n      .ai-data-viz__history-remove-btn {\n        background:rgb(54, 54, 54);\n        border: none;\n        color: #fff;\n        font-size: 11px;\n        padding: 2px 6px;\n        border-radius: 4px;\n        cursor: pointer;\n      }\n      .ai-data-viz__history-remove-btn:hover { opacity: 0.7; }\n      .ai-data-viz.dark .ai-data-viz__history-list li {\n        border-color: #444;\n      }\n      .ai-data-viz__history-list li:hover {\n        background: #f0f0f0;\n      }\n      .ai-data-viz.dark .ai-data-viz__history-list li:hover {\n        background: #333;\n      }\n\n      @media (max-width: 768px) {\n        .ai-data-viz {\n          padding: 16px;\n        }\n\n        .ai-data-viz__input-group {\n          flex-direction: column;\n        }\n\n        .ai-data-viz__generate-btn {\n          min-width: auto;\n        }\n\n        .ai-data-viz__iframe {\n          height: 400px;\n        }\n      }\n    `}setupEventListeners(){const t=this.container.querySelector(".ai-data-viz__textarea"),e=this.container.querySelector(".ai-data-viz__generate-btn"),i=this.container.querySelector(".ai-data-viz__clear-btn"),a=this.container.querySelector(".ai-data-viz__error-retry"),r=this.container.querySelector(".ai-data-viz__toggle-input"),o=this.container.querySelector(".ai-data-viz__history-list"),s=this.container.querySelector(".ai-data-viz__history-clear-btn");e.addEventListener("click",()=>this.generateVisualization()),i.addEventListener("click",()=>this.clearVisualization()),a.addEventListener("click",()=>this.generateVisualization()),r.addEventListener("click",()=>this.toggleInputSection()),o.addEventListener("click",t=>{const e=t.target.closest(".ai-data-viz__history-publish-btn"),i=t.target.closest(".ai-data-viz__history-remove-btn");if(e){t.stopPropagation();const i=e.closest("li");if(!i)return;const n=parseInt(i.getAttribute("data-index")||"-1",10);if(n>=0&&n<this.history.length){const t=this.history[n];if(this.config.publishGeneratedDiagram)try{this.config.publishGeneratedDiagram(t.html,t.prompt)}catch(t){console.error("publishGeneratedDiagram error",t)}else console.warn("publishGeneratedDiagram callback not provided")}return}if(i){t.stopPropagation();const e=i.closest("li");if(!e)return;const n=parseInt(e.getAttribute("data-index")||"-1",10);return void(n>=0&&n<this.history.length&&this.removeHistory(n))}const a=t.target.closest("li");if(!a)return;const r=parseInt(a.getAttribute("data-index")||"-1",10);if(r>=0&&r<this.history.length){const t=this.history[r];this.activeHistoryIndex=r,this.displayVisualization(t.html),this.container.querySelector(".ai-data-viz__textarea").value="";const e=this.container.querySelector(".ai-data-viz__prompt-summary"),i=this.container.querySelector(".ai-data-viz__prompt-text");e&&i&&(i.textContent=t.prompt,e.style.display="block",e.open=!1),this.originalPrompt=t.prompt,this.improvementPrompts=[],this.lastGeneratedCode=t.html,this.setState(n.DISPLAYING)}}),t.addEventListener("input",()=>{e.disabled=!t.value.trim()||this.state===n.GENERATING}),e.disabled=!0,s.addEventListener("click",()=>{this.clearHistory()})}toggleInputSection(){const t=this.container.querySelector(".ai-data-viz__input-section"),e=this.container.querySelector(".ai-data-viz__toggle-input");this.inputCollapsed=!this.inputCollapsed,this.inputCollapsed?(t.style.display="none",e.textContent="+",e.setAttribute("aria-label","Show input")):(t.style.display="block",e.textContent="−",e.setAttribute("aria-label","Hide input"))}setupMessageListener(){this.messageListener=t=>{var e;if(t.source!==(null===(e=this.iframe)||void 0===e?void 0:e.contentWindow))return;const i=t.data;"API_REQUEST"===i.type&&i.requestId&&i.url?this.handleApiRequest(i):"IFRAME_ERROR"===i.type&&(this.setState(n.ERROR),this.showError(i.message||"Visualization error"),this.config.onError&&this.config.onError(new Error(i.message||"Visualization error")))},window.addEventListener("message",this.messageListener)}async handleApiRequest(t){const{requestId:e,url:i}=t;try{const t=await this.config.apiRequest(i);this.sendMessageToIframe({type:"API_RESPONSE",requestId:e,data:t})}catch(t){this.sendMessageToIframe({type:"API_RESPONSE",requestId:e,error:t instanceof Error?t.message:"API request failed"})}}sendMessageToIframe(t){var e;(null===(e=this.iframe)||void 0===e?void 0:e.contentWindow)&&this.iframe.contentWindow.postMessage(t,"*")}async generateVisualization(){const t=this.container.querySelector(".ai-data-viz__textarea"),e=t.value.trim();if(e)try{const i=null!==this.lastGeneratedCode&&this.state===n.DISPLAYING;i?this.improvementPrompts.push(e):(this.originalPrompt=e,this.improvementPrompts=[]),this.setState(n.GENERATING),this.hideError();const o=i?this.buildImprovementPrompt(this.lastGeneratedCode):this.buildVisualizationPrompt(e);let s=await this.config.chatCompletion(o);if(s=this.sanitizeHtmlResponse(s),!s||!s.trim())throw new r(a.INVALID_HTML_RESPONSE,"AI returned empty response");this.displayVisualization(s),this.lastGeneratedCode=s;const d=this.container.querySelector(".ai-data-viz__prompt-summary"),l=this.container.querySelector(".ai-data-viz__prompt-text");if(d&&l){const t=[this.originalPrompt,...this.improvementPrompts].filter(Boolean).join("\n");l.textContent=t,d.style.display="block",d.open=!1}t.value="";const c={prompt:this.originalPrompt||e,html:s,timestamp:Date.now()};i&&null!==this.activeHistoryIndex?this.replaceHistory(this.activeHistoryIndex,c):(this.saveHistory(c),this.activeHistoryIndex=0),this.renderHistoryList(),this.setState(n.DISPLAYING)}catch(t){this.setState(n.ERROR);const e=t instanceof Error?t.message:"Failed to generate visualization";this.showError(e),this.config.onError&&this.config.onError(t instanceof Error?t:new Error(e))}else this.showError("Please enter a visualization request")}buildVisualizationPrompt(t){return`You are an expert front-end engineer who creates data visualizations.\n\nUSER REQUEST:\n"${t}"\n\nAVAILABLE API ENDPOINTS (OpenAPI-like schema):\n${this.config.apiDescription}\n\nTASK:\nGenerate a COMPLETE, self-contained HTML document (including CSS & JavaScript) that satisfies the user's request by fetching data from the listed API endpoints. Use Chart.js (CDN: https://cdn.jsdelivr.net/npm/chart.js) or native web technologies.\n\nREQUIREMENTS (IMPORTANT):\n• Return ONLY HTML/JS/CSS code – no markdown, explanations or extra text.\n• Include professional, responsive styling.\n• Use the provided global function \`apiRequest(url)\` for all data calls (see usage example below).\n• Handle loading states & errors gracefully within the HTML.\n• Do NOT violate browser sandbox restrictions.\n• Try to use all the available space for the diagram do NOT set max height or width.\n\nEXAMPLE API USAGE:\n\`\`\`js\nasync function loadData() {\n  const data = await apiRequest('/api/your-endpoint');\n  console.log(data);\n}\n\`\`\`\n\nReturn the finished HTML document now.`}buildImprovementPrompt(t){const e=[this.originalPrompt,...this.improvementPrompts].filter(Boolean).join("\n");return`You are provided with an EXISTING visualization (full HTML) generated earlier plus the complete history of user requests. Improve the visualization to satisfy the LATEST request while preserving prior context and functionality.\n\nAVAILABLE API ENDPOINTS:\n${this.config.apiDescription}\n\nEXISTING VISUALIZATION CODE START\n${t}\nEXISTING VISUALIZATION CODE END\n\nFULL USER REQUEST HISTORY:\n${e}\n\nREQUIREMENTS:\n• Return ONLY HTML/JS/CSS code (no explanations).\n• Produce a FULL HTML document that can replace the previous one.\n• Continue to use the global \`apiRequest(url)\` helper for data access.\n• Keep styling modern and responsive.\n• Gracefully handle loading and error states.`}displayVisualization(t){const e=this.container.querySelector(".ai-data-viz__visualization"),i=this.container.querySelector(".ai-data-viz__loading"),n=this.container.querySelector(".ai-data-viz__clear-btn");e.style.display="block",i.style.display="none",n.style.display="inline-block";const a=this.injectApiBridge(t);this.iframe=this.container.querySelector(".ai-data-viz__iframe"),this.iframe.srcdoc=a}injectApiBridge(t){const e="\n<script>(function(){window.apiRequest=function(u){return new Promise((res,rej)=>{const id='req_'+Date.now()+'_'+Math.random().toString(36).substr(2,9);function h(e){const d=e.data;if(d&&d.type==='API_RESPONSE'&&d.requestId===id){window.removeEventListener('message',h);d.error?rej(new Error(d.error)):res(d.data);}}window.addEventListener('message',h);window.parent.postMessage({type:'API_REQUEST',requestId:id,url:u},'*');setTimeout(()=>{window.removeEventListener('message',h);rej(new Error('API request timeout'));},3e4);});};})();<\/script>\n<script>window.addEventListener('error',e=>{window.parent.postMessage({type:'IFRAME_ERROR',message:e.message,stack:e.error&&e.error.stack},'*');});window.addEventListener('unhandledrejection',e=>{window.parent.postMessage({type:'IFRAME_ERROR',message:e.reason?e.reason.message||String(e.reason):'Unhandled rejection',stack:e.reason&&e.reason.stack},'*');});<\/script>",i=t.toLowerCase().indexOf("</head>");if(-1!==i)return t.slice(0,i)+e+t.slice(i);const n=t.toLowerCase().indexOf("<body");if(-1!==n){const i=t.indexOf(">",n)+1;return t.slice(0,i)+e+t.slice(i)}return e+t}sanitizeHtmlResponse(t){let e=t.trim();return e=e.replace(/^```\s*html\s*/i,"").replace(/^```/,""),e=e.replace(/```\s*$/i,"").trim(),e}clearVisualization(){const t=this.container.querySelector(".ai-data-viz__visualization"),e=this.container.querySelector(".ai-data-viz__clear-btn");t.style.display="none",e.style.display="none",this.setState(n.IDLE),this.hideError(),this.iframe&&(this.iframe.srcdoc=""),this.iframe=void 0,this.lastGeneratedCode=null,this.activeHistoryIndex=null,this.originalPrompt=null,this.improvementPrompts=[];const i=this.container.querySelector(".ai-data-viz__prompt-summary"),a=this.container.querySelector(".ai-data-viz__prompt-text");i&&a&&(i.style.display="none",a.textContent="")}setState(t){const e=this.container.querySelector(".ai-data-viz__generate-btn"),i=e.querySelector(".ai-data-viz__btn-text"),a=e.querySelector(".ai-data-viz__spinner"),r=this.container.querySelector(".ai-data-viz__textarea");switch(t){case n.GENERATING:e.disabled=!0,i.textContent="Generating...",a.style.display="block",r.disabled=!0;break;case n.DISPLAYING:e.disabled=!r.value.trim(),i.textContent="Improve Visualization",a.style.display="none",r.disabled=!1;break;case n.IDLE:case n.ERROR:e.disabled=!r.value.trim(),i.textContent="Generate Visualization",a.style.display="none",r.disabled=!1}}showError(t){const e=this.container.querySelector(".ai-data-viz__error");this.container.querySelector(".ai-data-viz__error-message").textContent=t,e.style.display="block"}hideError(){this.container.querySelector(".ai-data-viz__error").style.display="none"}destroy(){this.messageListener&&window.removeEventListener("message",this.messageListener),this.container.innerHTML="",this.iframe=void 0}getState(){return this.state}setTheme(t){this.container.querySelector(".ai-data-viz").className=`ai-data-viz ${t} ${this.config.className||""}`,this.config.theme=t}buildApiOverviewHtml(){var t;try{const e=JSON.parse(this.config.apiDescription);if(!e||"object"!=typeof e||!e.paths)return"";const i=[];for(const n in e.paths){const a=e.paths[n];if(a)for(const e in a){const r=(null===(t=a[e])||void 0===t?void 0:t.summary)||"";i.push(`<li><code>${e.toUpperCase()} ${n}</code>${r?" - "+r:""}</li>`)}}return i.length?`<ul style="margin:8px 0 0 16px;">${i.join("")}</ul>`:""}catch(t){return""}}loadHistory(){try{const t=localStorage.getItem(this.HISTORY_KEY);t&&(this.history=JSON.parse(t))}catch(t){}}saveHistory(t){this.history.unshift(t),this.history=this.history.slice(0,10);try{localStorage.setItem(this.HISTORY_KEY,JSON.stringify(this.history))}catch(t){}}replaceHistory(t,e){if(!(t<0||t>=this.history.length)){this.history[t]=e;try{localStorage.setItem(this.HISTORY_KEY,JSON.stringify(this.history))}catch(t){}}}renderHistoryList(){const t=this.container.querySelector(".ai-data-viz__history-list");t&&(t.innerHTML="",this.history.forEach((e,i)=>{const n=document.createElement("li");n.setAttribute("data-index",String(i));const a=document.createElement("span");a.textContent=`${new Date(e.timestamp).toLocaleString()} — ${e.prompt.slice(0,60)}`;const r=document.createElement("div");r.className="ai-data-viz__history-btn-div";const o=document.createElement("button");o.type="button",o.textContent="Publish",o.className="ai-data-viz__history-publish-btn";const s=document.createElement("button");s.type="button",s.textContent="Remove",s.className="ai-data-viz__history-remove-btn",r.appendChild(o),r.appendChild(s),n.appendChild(a),n.appendChild(r),t.appendChild(n)}))}clearHistory(){this.history=[],this.activeHistoryIndex=null;try{localStorage.removeItem(this.HISTORY_KEY)}catch(t){}this.renderHistoryList()}removeHistory(t){if(!(t<0||t>=this.history.length)){this.history.splice(t,1);try{localStorage.setItem(this.HISTORY_KEY,JSON.stringify(this.history))}catch(t){}this.renderHistoryList()}}}function s(t){return new o(t)}t=i.hmd(t);const d={create:s,AIDataVisualization:o,VisualizationState:n,ErrorType:a,AIDataVisualizationError:r},l={create:s,AIDataVisualization:o,VisualizationState:n,ErrorType:a,AIDataVisualizationError:r};"undefined"!=typeof window&&(window.AIDataVisualization=l),t.exports&&(t.exports=l)}},e={};function i(n){var a=e[n];if(void 0!==a)return a.exports;var r=e[n]={id:n,loaded:!1,exports:{}};return t[n](r,r.exports,i),r.loaded=!0,r.exports}return i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.hmd=t=>((t=Object.create(t)).children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i(683)})());