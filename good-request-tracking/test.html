<!DOCTYPE html>
<html>
<head>
    <title>Fetch/XHR Test Page</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { padding: 10px 20px; margin: 10px; font-size: 14px; }
        .results { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 4px; }
        pre { background: #fff; padding: 10px; border: 1px solid #ddd; overflow: auto; }
    </style>
</head>
<body>
    <h1>üß™ Extension Test Page</h1>
    <p>This page will help you test the Fetch/XHR interceptor extension.</p>
    
    <h2>Test Buttons</h2>
    <button onclick="testJsonApi()">Test JSON API (JSONPlaceholder)</button>
    <button onclick="testLocalJson()">Test Local JSON</button>
    <button onclick="testXHR()">Test XMLHttpRequest</button>
    <button onclick="testTextResponse()">Test Text Response</button>
    
    <h2>Results</h2>
    <div id="results" class="results">
        <p>Click buttons above to test. Check:</p>
        <ol>
            <li>Browser console for interceptor logs</li>
            <li>Extension popup for schemas</li>
            <li>DevTools Network tab</li>
        </ol>
    </div>

    <script>
        function log(message) {
            const results = document.getElementById('results');
            results.innerHTML += `<p>${new Date().toLocaleTimeString()}: ${message}</p>`;
        }

        async function testJsonApi() {
            log('Testing JSONPlaceholder API...');
            try {
                const response = await fetch('https://jsonplaceholder.typicode.com/posts/1');
                const data = await response.json();
                log(`‚úÖ JSON API Response: ${JSON.stringify(data).substring(0, 100)}...`);
            } catch (error) {
                log(`‚ùå Error: ${error.message}`);
            }
        }

        async function testLocalJson() {
            log('Testing with local JSON data...');
            try {
                // Create a data URL with JSON
                const jsonData = {
                    id: 123,
                    name: "Test User",
                    email: "test@example.com",
                    timestamp: new Date().toISOString(),
                    nested: {
                        level: 1,
                        items: ["a", "b", "c"]
                    }
                };
                
                const blob = new Blob([JSON.stringify(jsonData)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const response = await fetch(url);
                const data = await response.json();
                log(`‚úÖ Local JSON Response: ${JSON.stringify(data).substring(0, 100)}...`);
                
                URL.revokeObjectURL(url);
            } catch (error) {
                log(`‚ùå Error: ${error.message}`);
            }
        }

        function testXHR() {
            log('Testing XMLHttpRequest...');
            const xhr = new XMLHttpRequest();
            xhr.open('GET', 'https://jsonplaceholder.typicode.com/users/1');
            xhr.onload = function() {
                if (xhr.status === 200) {
                    log(`‚úÖ XHR Response: ${xhr.responseText.substring(0, 100)}...`);
                } else {
                    log(`‚ùå XHR Error: ${xhr.status}`);
                }
            };
            xhr.onerror = function() {
                log(`‚ùå XHR Network Error`);
            };
            xhr.send();
        }

        async function testTextResponse() {
            log('Testing text response...');
            try {
                const response = await fetch('data:text/plain,Hello World! This is a text response.');
                const text = await response.text();
                log(`‚úÖ Text Response: ${text}`);
            } catch (error) {
                log(`‚ùå Error: ${error.message}`);
            }
        }
    </script>
</body>
</html>